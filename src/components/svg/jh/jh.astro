---
import genRandomToken from "../../../utils/gen-random-token.mjs";
import fractionalStops from "../../../utils/fractional-stops.mjs";

const {class:className, start=-1, stop=1, animate=false, image='https://hatrabbits.com/wp-content/uploads/2017/01/random.jpg', ...ani} = Astro.props;

const length = 268.4;// document.querySelector("svg path").getTotalLength()

const randomToken = genRandomToken('-');
const animationEntries = [`animation-name: dash${randomToken};`, '\n']

for (const [key, value] of Object.entries(ani)) {
  if(!key.startsWith('animation-')){
    continue;
  }
  animationEntries.push(key, ':', value, ';', '\n');
}

const stops = [1, 20];
const percentages = [...fractionalStops(...stops)].map(x=>`${(x*100).toFixed(0)}%`);
const offsets = [start, start, stop];
const a = percentages.map((percentage, index)=>`${percentage} {
      stroke-dashoffset: ${offsets[index]*length};
    }
`).join('\n');

const style = `<style>
  @keyframes dash${randomToken} {
${a}
  }
  .path${randomToken} path  {
    stroke-dasharray: ${length};
    stroke-dashoffset: ${animate ? length : 0};
    ${animate && animationEntries.join('')}
  }
</style>`;

---
{style}
<svg class={`path${randomToken} ${className}`} width="67.733" height="67.733" version="1.1" viewBox="0 0 67.733 67.733" xmlns="http://www.w3.org/2000/svg">
 <path d="m27.252 12.435v23.019a6.6146 6.6146 0 0 1-6.6146 6.6146 6.6146 6.6146 0 0 1-6.6146-6.6146h-13.229a19.844 19.844 0 0 0 19.844 19.844 19.844 19.844 0 0 0 19.192-14.817h13.881v14.817h13.229v-42.862h-13.229v14.817h-13.229v-14.817z" fill="none" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.0583"/>
 
</svg>
